<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalna Faktura XML</title>
    <link rel="stylesheet" href="style5.css"> 
</head>
<body>

    <div id="faktura-container">
        
        <h1>FAKTURA PROFORMA</h1>
        
        <p>Miejsce i Data: <span id="miejscowosc_data"></span></p>
        <p>Termin płatności: <span id="termin_platnosci"></span> | Forma: <span id="forma_platnosci"></span> | Dostawa: <span id="data_dostawy"></span></p>

        <div class="info-block">
            <div class="strona">
                <h3>SPRZEDAWCA</h3>
                <div id="sprzedawca_dane"></div>
            </div>
            <div class="strona">
                <h3>NABYWCA</h3>
                <div id="nabywca_dane"></div>
            </div>
        </div>
        
        <p>Nr konta: <span id="sprzedawca_bank_nr_konta"></span></p>

        <h3>Pozycje:</h3>
        <div class="tabela-naglowek">L.p. | Nazwa | Cena netto | Wartość netto | VAT | Wartość z VAT</div>
        <div id="pozycje-tabeli"></div>

        <div class="sumy">
            <p>RAZEM NETTO: <span id="netto_sum"></span></p>
            <p>RAZEM VAT: <span id="vat_sum"></span></p>
            <h3>RAZEM BRUTTO: <span id="brutto_sum"></span></h3>
        </div>
        
        <div class="platnosci">
            <p>Do zapłaty: <span id="do_zaplaty"></span> PLN</p>
            <p>Pozostało: <span id="pozostalo"></span> PLN</p>
        </div>

        <div class="podpisy">
            <p>Wystawił: <span id="dokument_wystawil"></span></p>
            <p>Odebrał: <span id="dokument_odebral"></span></p>
        </div>
    </div>

    <script>
        const XML_FILE = "dane.xml"; 

        function getText(xmlDoc, tag, parentTag = null) {
            let selector = tag;
            if (parentTag) { selector = parentTag + ' ' + tag; }
            const node = xmlDoc.querySelector(selector);
            return node ? node.textContent.trim() : '';
        }
        
        const formatujLiczbe = (liczba) => String(liczba).replace('.', ',');

        function wypelnijFakture(xmlDoc) {

            const s_nazwa = getText(xmlDoc, 'nazwa', 'sprzedawca');
            const s_adres = getText(xmlDoc, 'adres', 'sprzedawca');
            document.getElementById('sprzedawca_dane').innerHTML = `<strong>${s_nazwa}</strong><br>${s_adres}`;
            
            const n_nazwa = getText(xmlDoc, 'nazwa', 'nabywca');
            const n_adres = getText(xmlDoc, 'adres', 'nabywca');
            document.getElementById('nabywca_dane').innerHTML = `<strong>${n_nazwa}</strong><br>${n_adres}`;

            document.getElementById('miejscowosc_data').textContent = `${getText(xmlDoc, 'miejscowosc')}, ${getText(xmlDoc, 'data_wystawienia')}`;
            document.getElementById('termin_platnosci').textContent = getText(xmlDoc, 'termin_platnosci');
            document.getElementById('forma_platnosci').textContent = getText(xmlDoc, 'forma_platnosci');
            document.getElementById('data_dostawy').textContent = getText(xmlDoc, 'data_dostawy');
            document.getElementById('sprzedawca_bank_nr_konta').textContent = getText(xmlDoc, 'nr_konta', 'sprzedawca');

            const pozycja = xmlDoc.querySelector('pozycja');
            if (pozycja) {
                const p = (tag) => formatujLiczbe(pozycja.querySelector(tag).textContent);
                
                document.getElementById('pozycje-tabeli').innerHTML = `
                    <div class="wiersz-danych">
                        <span>${pozycja.getAttribute('lp')}</span>
                        <span>${pozycja.querySelector('nazwa').textContent}</span>
                        <span>${p('cena_netto')}</span>
                        <span>${p('wartosc_netto')}</span>
                        <span>${pozycja.querySelector('stawka_vat').textContent}</span>
                        <span>${p('wartosc_brutto')}</span>
                    </div>
                `;
            }

       
            const pobierzSume = (tag) => formatujLiczbe(getText(xmlDoc, tag, 'podsumowanie'));
            document.getElementById('netto_sum').textContent = pobierzSume('netto_sum');
            document.getElementById('vat_sum').textContent = pobierzSume('vat_sum');
            document.getElementById('brutto_sum').textContent = pobierzSume('brutto_sum');
            document.getElementById('do_zaplaty').textContent = pobierzSume('do_zaplaty');
            document.getElementById('pozostalo').textContent = pobierzSume('pozostalo');
            
           
            document.getElementById('dokument_wystawil').textContent = getText(xmlDoc, 'wystawil', 'podpisy');
            document.getElementById('dokument_odebral').textContent = getText(xmlDoc, 'odebral', 'podpisy');
        }


        document.addEventListener("DOMContentLoaded", function() {
            fetch(XML_FILE)
                .then(response => response.text()) 
                .then(xmlDataString => {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlDataString, "text/xml"); 
                    if (xmlDoc.getElementsByTagName("parsererror").length) {
                        throw new Error("Błąd parsowania XML.");
                    }
                    wypelnijFakture(xmlDoc);
                })
                .catch(error => {
                    document.getElementById('faktura-container').innerHTML = 
                        `<h3 style="color: red;">BŁĄD: Nie udało się załadować danych.</h3>`;
                });
        });
    </script>
</body>
</html>
